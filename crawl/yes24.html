<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="https://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">

<head>
    <title>YES24 공연 &gt; 좌석HTML</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
    <meta name="svg.render.forceflash" content="true" />
    <link href="/include/css/reserve_seat_2013.css" type="text/css" rel="stylesheet" />
    <link href="/Pages/Perf/Sale/Css/importPerfsale.css" type="text/css" rel="stylesheet">
    <style type="text/css">
	.s0 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat0.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s1 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat1.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s2 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat2.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s3 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat3.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s4 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat4.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s5 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat5.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s6 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat6.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s7 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat7.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s8 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat8.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s9 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat9.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s10 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat10.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s11 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat11.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s12 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat12.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s13 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat13.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s14 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat14.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s15 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat15.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s16 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat16.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s17 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat17.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s18 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat18.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s19 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat19.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s20 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat20.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s21 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat21.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s22 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat22.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s23 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat23.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.s24 {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat24.gif') no-repeat; height:12px;width:11px; z-index:10;}
	.son {position:absolute; background:url('http://tkfile.yes24.com/images/ticket_new/ic_seat_on.gif') no-repeat; height:12px;width:11px; z-index:10;}
			
	.bx_seatbg .seatarea .bx_con1 { position: relative; left: 0px; top: 0px; z-index: 0; overflow:auto; width:680; height:600px; background:#fff url('http://tkfile.yes24.com/images/ticket_new/bx2_seat2.jpg') no-repeat left bottom; text-align:center; }
	.raffer { position: absolute; left: 30px; top: 0px; z-index: 0; overflow:visible; }
	.csblkInfo { position:absolute; font-size:12px; color:#ffffff; border:#2080D0 solid 1px; background-color:#FF6600; top:0px; left:0px; z-index:200; padding:5px; } /*201402HTMLSEAT*/
	.bxdmap { font-size:12px; }
	.seatMap { position:absolute; top:57px; left:758px; z-index:11; filter:Alpha(Opacity=70); -moz-opacity:0.7; opacity:0.7; font-size:12px; overflow-x:auto; width:188px; height:200px; } /*201402HTMLSEAT*/
	.mapFocus { position:absolute; top:57px!important; left:757px!important; z-index:0; width:188px; height:203px; }
	.bx_seatbg .seatarea {float:left; width:746px;  background:#fff;}
	.bx_seatbg .seatarea, .bx_seatbg .seatinfo{ margin-top:20px;} 
	.bigSeatMap { position:absolute; top:32px; left:0px; z-index:100; filter:Alpha(Opacity=70); -moz-opacity:0.7; opacity:0.7; width:745px; height:600px;  overflow:visible; text-align:center; } /*201402HTMLSEAT*/    
	.bigmapFocus { position:absolute; top:32px!important; left:0px; z-index:90; height:600px; text-align:center; } /*201402HTMLSEAT -> 20140320HTMLSEAT*/
	.seatGroup   {position:absolute; z-index:1;} /*20140415HTMLSEAT*/ 

	/* 공연장 전체보기 관련 css */
	.minimap_m {margin-top:10px;}
	.minimap_m .btn_all {margin-bottom:10px;}
	.bx_seatbg .seatinfo ul li.bx3_wbg {  background: url('http://tkfile.yes24.com/images/ticket_new/bx3_minimap2.gif') repeat-y 0 0;}
	.bx_seatbg .seatinfo ul {width:203px;float:none;}
	.bx_seatbg .seatinfo ul li p.txt {color:#333;margin: 3px 5px;}
	.bx_seatbg .seatinfo ul li p.txt em {color:#6699cc; padding-left:2px}
    .bx_seatbg .seatinfo ul li p.txt.ov {background:#dde9f4; font-weight:bold; padding:4px 0 2px 0}
	.bx_seatbg .seatinfo .seat_layer {width:170px; padding:2px 8px; margin-bottom:0px}
	.bx_seatbg .seatinfo .seat_layer li {padding: 0 0 0 17px}
	.bx_seatbg .seatinfo ul li.bx3_wbg2 {min-height:100px}
	.bx_seatbg .seatinfo .btn {width:203px}

	/* 예매 단계 내 좌석 선점 시간 안내 */
    .t_info {position:absolute;z-index:100; left:757px; top:355px; background:#f2f2f2; border:1px solid #ccc; width:181px; padding:10px; text-align:center}
    .t_info span {font-size:11px}
    
</style>
    <script type="text/javascript" src="/include/jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="/include/jssvg/svg.js"></script>
    <script type="text/javascript" src="/include/js/default.js"></script>
    <script type="text/javascript">
        try {
            if (document.implementation.hasFeature('https://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') == true) {
                $("meta[name=svg.render.forceflash]").attr("content", "false");
            }
        } catch (e) { }

        //begin 201402HTMLSEAT -> 20140314HTMLSEAT--> 20140403HTMLSEAT
        function toggleBigHtmlMap(dis) {

            GetTimeSaleState();

            if (dis == 0) {
                $("#dBigHtmlMap").css("display", "none");
                if (mapType == "2") {
                    $("#dBigMapFocus").css("display", "none");
                }
            } else {
                $("#divSeatArray").html("");
                $("#divContainer").css("display", "none");
                //$("#liLegend").html("");
                $("#liSelSeat").html("");
                $("#dBigHtmlMap").css("display", "");
                if (mapType == "2") {
                    $("#dBigMapFocus").css("display", "");
                }
            }
        }
        //end 201402HTMLSEAT -> 20140314HTMLSEAT--> 20140403HTMLSEAT
    </script>
</head>
<body style="background-position: fixed;">
    <div id="dBigHtmlMap" class="bigSeatMap" onmouseout="outMap();"></div> <!--201402HTMLSEAT-->
    <form name="form1" method="post" action="./PerfSaleHtmlSeat.aspx?idTime=977516&amp;idHall=8130&amp;block=0&amp;stMax=10&amp;pHCardAppOpt=0" id="form1">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEwOTEzODEzNjlkZFb57hPzizT2BsJ5GI7J7dlEiwiZ" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="B49EE540" />
</div>
    <!-- 좌석 정보 -->
    <div class="bx_seatbg">
        <div class="seatarea">
            <div class="bx_top"></div>
            <div id="divGuide" class="bx_con1">
                <div id="divContainer" class="raffer">
                    <div id="divSeatArray"></div>
                </div>
            </div>
        </div>
        <div class="seatinfo">
            <div class="minimap_m">
                <!-- 미니맵 -->
                <p id="minimapTitle" ><img src="http://tkfile.yes24.com/images/ticket_new/tit2_minimap1.gif" alt="공연장 미니맵" class="tit" /></p>
                <ul id="minimap">
                   <li class="list_no"><img src="http://tkfile.yes24.com/images/ticket_new/tit2_minimap1_1.gif" alt="" title="구역 이동은 미니맵을 이용해주세요" /></li>
                    <li id="liminiMap" class="list_no" style="text-align: center; height:203px;"><span><!--맵표시부분--></span></li>
                </ul>
                <!-- //미니맵 -->
                <!--  좌석 등급/가격 -->
                <p><img src="http://tkfile.yes24.com/img/htmlseat/tit2_minimap2.gif" alt="좌석 등급 및 가격" class="tit" /></p>
                <ul id="ulLegend">
                    <li class="list_no"><img src="http://tkfile.yes24.com/images/ticket_new/bx3_minimap1.gif" alt="" /></li>
                    <li id="liLegend" class="bx3_wbg bx3_wbg2"></li><li class="list_no"><img src="http://tkfile.yes24.com/images/ticket_new/bx3_minimap3.gif" alt="" /></li>
                </ul>
                <!--  //좌석 등급/가격 -->
                <!--  선택좌석 -->
                <div class="t_info"  style="display:none;">
					<span>좌석 선택 후 3분 내에 결제가 완료되지 않을 경우 선택하신 좌석의 선점기회를 잃게 됩니다. </span>
				</div>
                <p><a href="javascript:retrun false;" onmouseover="$('.t_info').show();" onmouseout="$('.t_info').hide();"><img src="http://tkfile.yes24.com/img/htmlseat/tit2_minimap4.gif" alt="선택좌석" class="tit" /></a></p>
                <ul>
                    <li class="list_no"><img src="http://tkfile.yes24.com/images/ticket_new/bx3_minimap1.gif" alt="" /></li>
                    <li id="liSelSeat" class="bx3_wbg bx3_wbg3"></li>
                    <li class="list_no"><img src="http://tkfile.yes24.com/images/ticket_new/bx3_minimap3.gif" alt="" /></li>
                </ul>
                <!--  //선택좌석 -->
                <div class="btn">
                    <p>
                        <a href="javascript:closeseat();"><img src="http://tkfile.yes24.com/images/ticket_new/btn_pre.gif" alt="이전화면" /></a>
                        <a href="javascript:ChoiceReset();"><img src="http://tkfile.yes24.com/images/ticket_new/btn_refresh.gif" alt="좌석선택다시" /></a>
                    </p>
                    <p>
                        <a href="javascript:ChoiceEnd();"><img src="http://tkfile.yes24.com/images/ticket_new/btn_booking.gif" alt="좌석선택완료" class="booking" /></a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- //좌석 정보 -->
    <div id="progressbar" style="position: absolute; left: 300px; top: 250px;"><img src="http://tkfile.yes24.com/img/perfsale/loading_re.gif" alt="로딩이미지" /></div>
    <div id="blkInfo" class="csblkInfo" style="display: none"></div>
    <div id="dMapInfo" class="seatMap" style="width:203px;"   onmouseout="outMap();"></div>
    <!--begin 201402HTMLSEAT_20140403HTMLSEAT-->
    <div class="mapFocus" id="dMapFocus" style="display:none">
        <script type="image/svg+xml">
            <svg id="svgmap" width="184" height="171" xmlns="https://www.w3.org/2000/svg" version="1.1" baseProfile="full"></svg>
        </script>
    </div>
    <div class="bigmapFocus" id="dBigMapFocus" style="display:none">
        <script type="image/svg+xml">
            <svg id="svgmapbig" height="600" xmlns="https://www.w3.org/2000/svg" version="1.1" baseProfile="full"></svg>
        </script>
    </div>
    <!--end 201402HTMLSEAT_20140403HTMLSEAT-->
    <script type="text/javascript">
        var OSIFRootUrl = "";
        var isLoadedSvg = false; //20140403HTMLSEAT
        var IdHall = '8130';
        var IdTime = '977516';
        var Block = '0';
        var StMax = parseInt('10');
        var IdCustomer = '13702112';
        var HCardAppOpt = '0';
        var IdOrg = 1;
        var layerWidth = 678;
        var layerHeight = 585;
        var _split = "@";
        var _lines = "^";
        var mapType = "0";
        var ArBlockRemain = new Array();
        var ArSectionRemain = new Array();
        var ArBlockFile = new Array();

        /* begin 20140410HTMLSEAT*/
        var isIe9over = false;
        if ($.browser.msie) {
            if ($.browser.version >= 9) {
                isIe9over = true;
            }
        }
        /* end 20140410HTMLSEAT*/

        $("#divContainer").css({ width: layerWidth, height: layerHeight });

        function errormsg(msg) {
            //alert(msg);
        }

        function GetImgPath() {
            var HallRoot = 0;
            HallRoot = parseInt((parseInt(IdHall, 10) / 1000), 10) * 1000

            return "http://tkfile.yes24.com/upload2/hallimg/" + HallRoot + "/" + IdHall + "/";
            //return "http://testticket.yes24.com/upload2/hallimg/" + HallRoot + "/" + IdHall + "/";
        }


        //begin 201402HTMLSEAT
        function GetImageMap() {

            $("#progressbar").css("display", "");
            $("#divContainer").css("display", "none");
            $.ajax({
                type: "post",
                url: OSIFRootUrl + "/OSIF/Book.asmx/GetHallMapRemain",
                data: { "idHall": IdHall, "idTime": IdTime },
                dataType: "xml",
                async: true,
                success: function (response) {
                    GetImageMap_CallBack(response);
                },
                error: function (response) {
                    errormsg(response.responseText);
                }
            });
        }

        //20140314HTMLSEAT (좌석등급 정보 추가)
        function GetImageMap_CallBack(msg) {
            var timdid = $(msg).find("IdTime").text();
            if (timdid != IdTime) {
                return;
            }
            var blockRemain = $(msg).find("BlockRemain").text();
            var miniMap = $(msg).find("SeatMap").text();
            var regend = $(msg).find("Regend").text();
            var section = $(msg).find("Section").text();

            CreateRemainArgs(blockRemain);
            CreateMiniMap(miniMap);
            CreateLegend(regend);
            CreateSection(section);
            //GetSeatData(Block, 0); 
        }
        //end 201402HTMLSEAT

        function GroupTicketMove() {
            jQuery.each($(".seatGroup"), function () {
                var moveTop = parseInt($(this).attr("mtop"));
                var moveLeft = parseInt($(this).attr("mleft"));
                var grpTop = parseInt($(this).css("top")) + moveTop;
                var grpLeft = parseInt($(this).css("left")) + moveLeft;

                $(this).css({ top: grpTop, left: grpLeft });
            });
        }

        //일괄 데이터 가져오기
        function GetSeatData(blk, seq) {
            Block = blk;

            $("#progressbar").css("display", "");
            $("#divContainer").css("display", "none");

            $("#divSeatArray").html("");
            //            $("#liLegend").html("");
            $("#liSelSeat").html("");

            $.ajax({
                type: "post",
                url: OSIFRootUrl + "/OSIF/Book.asmx/GetBookWhole",
                data: { "idHall": IdHall, "idTime": IdTime, "block": Block, "channel": 1, "idCustomer": IdCustomer, "idOrg": 1 },
                dataType: "xml",
                async: true,
                success: function (msg) {
                    GetSeatData_CallBack(msg, seq);
                },
                error: function (msg) {
                    errormsg(msg.responseText);
                }
            });
        }

        //판매가능 상태 확인
        function GetTimeSaleState() {
            $.ajax({
                type: "post",
                url: "/Pages/Perf/Sale/Ajax/Perf/TimeSaleState.aspx",
                data: { PIdTime: IdTime },
                dataType: "html",
                async: false,
                success: function (msg) {
                    GetTimeSaleStat_CallBack(msg);
                },
                error: function (msg) {
                    errormsg(msg.responseText);
                }
            });
        }

        function GetTimeSaleStat_CallBack(Data) {
            if (Data == "0") {
                alert('판매가능한 회차자 아닙니다.');
                $("body").html("");
            }
        }

        function GetSeatData_CallBack(msg, seq) {
            var timdid = $(msg).find("IdTime").text();
            var blockid = $(msg).find("Block").text();

            if ((timdid == IdTime && blockid == Block) == false) {
                return;
            }

            var hallLayout = $(msg).find("Layout").text();
            var background = $(msg).find("Background").text();
            //            var regend = $(msg).find("Regend").text();
            //            var section = $(msg).find("Section").text();
            var blockRemain = $(msg).find("BlockRemain").text();
            var blockSeat = $(msg).find("BlockSeat").text();


            $("#divSeatArray").html(hallLayout);

            /* begin 20140410HTMLSEAT*/
            if (isIe9over) {
                jQuery("div").css("filter", "");
            }
            /* end 20140410HTMLSEAT*/

            CreateHallBgImg(background);
            //          CreateLegend(regend);
            //          CreateSection(section);
            CreateRemainArgs(blockRemain);
            TicketMapping(blockSeat);

            //20140410HTMLSEAT
            if (navigator.userAgent.toLowerCase().indexOf('msie') == -1 || isIe9over) {
                GroupTicketMove();
            }

            if (ArBlockFile[Block] != null && seq != 0) {
                $("#blockFile").attr("src", GetImgPath() + ArBlockFile[Block]);
            }

            $("#progressbar").css("display", "none");
            $("#divContainer").css("display", "");

            //begin 201402HTMLSEAT -> 20140403HTMLSEAT
            if (mapType == "1") {
                if (seq == 0) {
                    if (isLoadedSvg) {
                        MapFocusCreate(Block, 'mapFs', '#FFF000');
                    } else {
                        window.addEventListener('SVGLoad', function () {
                            MapFocusCreate(Block, 'mapFs', '#FFF000');
                        }, false);
                    }
                } else {
                    MapFocusCreate(Block, 'mapFs', '#FFF000');
                }
            }
            toggleBigHtmlMap(0);
            //begin 201402HTMLSEAT -> 20140403HTMLSEAT
        }

        GetImageMap();

        //begin 201402HTMLSEAT
        function ChangeBlock(blk) {
            if (document.getElementById('mapFs') != null) {
                $("#mapFs").remove();
            }
            $("#mapFs").remove(); //20140403HTMLSEAT one more delete
            if (document.getElementById('mapOver') != null) {
                $("#mapOver").remove();
            }
            $("#blkInfo").css("display", "none");
            GetSeatData(blk, 1);
        }
        //end 201402HTMLSEAT

        //연석 체크 시작
        function ChkSequenceSeat() {
            var arrSelSeat = [];

            jQuery.each($("p[name=cseat]"), function (index) {

                var titleThis = $(this).text().split(' ')[1].substring(0, 1);
                //2층 A3구역1열 002번 -> A

                var idThis = $(this).attr("id");
                if ((IdTime == "875463" || IdTime == "877531" || IdTime == "877657" || IdTime == "877658" || IdTime == "906865" || IdTime == "906965" || IdTime == "906966") && (titleThis == "A" || titleThis == "B" || titleThis == "D" || titleThis == "E")) { //세로줄 
                    //console.log(parseInt(Right(idThis.replace('C', ''), 2) + idThis.replace('C', '').substring(0, 2)));
                    arrSelSeat[index] = parseInt(Right(idThis.replace('C', ''), 2) + idThis.replace('C', '').substring(0, 2));
                }
                else {
                    arrSelSeat[index] = parseInt(idThis.replace('C', ''));
                }

                arrSelSeat.sort();

            });

            var chkSeq = checkSequnceNumbers(arrSelSeat, StMax);
            if (chkSeq[arrSelSeat.length - 1] != 1)
                return false;
            else
                return true;
        }

        function checkSequnceNumbers(target, counterLength) { //counterLength는 최대매수
            //var sequentialCounter = new Array(counterLength).fill(0);
            var sequentialCounter = [];
            for (var j = 0; j != counterLength; j++)
                sequentialCounter.push(0);

            var count = 0;
            for (var i = 0, len = target.length; i < len; i++) {
                var subCount = 0;
                for (var j = 1; j < len; j++) {
                    if (target[j] === (target[i] + 1)) {
                        subCount = subCount + 1;
                    } else {
                        continue;
                    }
                }
                count = count + subCount;
                if (subCount === 0) {
                    sequentialCounter[count] = sequentialCounter[count] + 1;
                    count = 0;
                }
            }
            return sequentialCounter;
        }

        function Right(str, n) {
            if (n <= 0)
                return "";
            else if (n > String(str).length)
                return str;
            else {
                var iLen = String(str).length;
                return String(str).substring(iLen, iLen - n);
            }
        }
        //연석 체크 끝


        //선택완료
        function ChoiceEnd() {

            var selSeatCnt = $("p[name=cseat]").length;

            if (selSeatCnt == 0) {
                alert('좌석을 선택해주세요.');
                return;
            }

            if (IdTime == "875463" || IdTime == "877498" || IdTime == "877530" ||
                IdTime == "877531" || IdTime == "877657" || IdTime == "877658" ||
                IdTime == "877623" || IdTime == "877659" || IdTime == "877660" ||
                IdTime == "877624" || IdTime == "877661" || IdTime == "877662" ||
                IdTime == "906865" || IdTime == "906965" || IdTime == "906966" ||
                IdTime == "906792" || IdTime == "906794" || IdTime == "906795" ||
                IdTime == "906652" || IdTime == "906643" || IdTime == "906653" ||
                IdTime == "968211" || IdTime == "968263")
            { //나훈아티켓 서울/부산/대구
                //연석 체크
                if (!ChkSequenceSeat()) {
                    //alert("연속된 좌석을 선택해 주세요.");
                    //return;
                    if (!confirm("연속된 좌석이 선택되지 않았습니다. 계속하시겠습니까?")) {
                        ChoiceReset();
                        return;
                    }
                }
            }

            var token = "";
            var tokenClass = "";


            jQuery.each($("p[name=cseat]"), function () {

                //0616수정
                var idThis = $(this).attr("id");

                if (token != "") {
                    token += "," + idThis.replace('C', '');
                } else {
                    token += idThis.replace('C', '');
                }


                if (tokenClass != "") {
                    tokenClass += "," + $(this).attr("grade");
                } else {
                    tokenClass += $(this).attr("grade");
                }
            });



            if (token == "" || tokenClass == "") {
                alert('좌석 선택정보가 올바르지 않습니다.');
                return;
            }

            if (HCardAppOpt == "1") {

                if ((selSeatCnt > 2) && (tokenClass.indexOf('G1석') != -1 || tokenClass.indexOf('G2석') != -1)) {
                    alert('현대카드 앱카드 30%할인은\nG3~C석에 한해 2매만 선택 가능합니다.');
                    return;
                }

                if (selSeatCnt > 2) {
                    alert('현대카드 앱카드 30%할인은\n1인 2매 할인 가능합니다.');
                    return;
                }

                if (tokenClass.indexOf('G1석') != -1 || tokenClass.indexOf('G2석') != -1) {
                    alert('현대카드 앱카드 30%할인은\nG3~C석에 한해 할인 가능합니다.\n(G1석,G2석은 일반예매로만 가능)');
                    return;
                }
            }

            if (IdTime == '720503' || IdTime == '720504' || IdTime == '720505' || IdTime == '720506' || IdTime == '720507' ||
                IdTime == '720508' || IdTime == '720512' || IdTime == '720513' || IdTime == '720514' || IdTime == '720516' ||
                IdTime == '720517' || IdTime == '720518' || IdTime == '720519' || IdTime == '720520' || IdTime == '720515' ||
                IdTime == "718882" || IdTime == '718875' || IdTime == '718879' || IdTime == '718880' || IdTime == '718881' || IdTime == '718882' ||
                IdTime == '718883') {

                var classinfo = tokenClass.split(",");
                var nVipCnt = 0;

                for (var i = 0; i < classinfo.length; i++) {
                    if (classinfo[i] == "VIP(1인1매)석") {
                        nVipCnt += 1;
                    }
                }

                if (nVipCnt > 1) {
                    alert('예매 가능한 매수가 초과되었습니다.\n예매중인 회차의 VIP(1인1매)석은 1매만 예매가 가능합니다.');
                    return;
                }
            }


            $.ajax({
                type: "post",
                url: OSIFRootUrl + "/OSIF/Book.asmx/Lock",
                data: { "name": IdCustomer, "idTime": IdTime, "token": token, "Block": Block},
                dataType: "xml",
                async: true,
                success: function (msg) {
                    ChoiceEnd_CallBack(msg, token, tokenClass);
                },
                error: function (msg) {
                    errormsg(msg.responseText);
                }
            });
        }

        function ChoiceEnd_CallBack(msg, token, tokenClass) {
            var lockResult = $(msg).find("int").text();

            if (lockResult == "0") {
                ChoiceEndProcess(token + "@" + tokenClass);
            } else {
                alert('다른 고객님이 결제진행 중인 좌석입니다.\n다른 좌석을 선택해 주세요.');
                GetSeatData(Block, 1);
                //ChoiceReset(); //2011.12.12 추가
                //resetseat(); //hsjung 수정(2012.04.25)
            }
        }

        //좌석선택
        function ChoiceSeat() {

            if ($(this).attr("className") == "son") {
                $("#C" + $(this).attr("value")).remove();
                $(this).attr("className", $(this).attr("oldclass"));
            } else {
                if ($("p[name=cseat]").length < StMax) {
                    $("#liSelSeat").append('<p id="C' + $(this).attr("value") + '" class="txt2" name="cseat" grade="' + $(this).attr("grade") + '">' + $(this).attr("title") + '</p>');
                    //$("#liSelSeat").append('<p id="C' + $(this).attr("value") + '"  name="cseat" grade="' + $(this).attr("grade") + '">' + $(this).attr("title") + '</p>');
                    $(this).attr("oldclass", $(this).attr("className"));
                    $(this).attr("className", "son");
                } else {
                    alert(StMax + '좌석 까지만 선택이 가능합니다.');
                }
            }
        }

        //다시선택
        function ChoiceReset() {
            jQuery.each($("p[name=cseat]"), function () {
                //0616수정
                var idThis = $(this).attr("id");
                $("#t" + idThis.replace('C', '')).attr("className", $($("#t" + idThis.replace('C', ''))).attr("oldclass"));
            });
            $("#liSelSeat").html("");
        }

        //begin 201402HTMLSEAT
        function CreateMiniMap(mapData) {
            var mapfiles = "";
            ArBlockFile = new Array();
            if (mapData.indexOf(_split) != -1) {
                var msgblocks = mapData.split(_lines);
                var imagemap = '<map name = "maphall">';
                for (var i = 0; i < msgblocks.length; i++) {
                    var msgblock = msgblocks[i].split(_split);
                    if (msgblock.length > 3) {
                        if (Block == msgblock[0]) {
                            mapfiles = '<img id="blockFile" src="' + GetImgPath() + msgblock[1] + '" border=0 usemap="#maphall" onfocus="this.blur();" />';
                        }
                        imagemap += '<area shape="poly" info="' + msgblock[3] + '" id="area' + msgblock[0] + '" value="' + msgblock[0] + '" coords="' + msgblock[2] + '"  href="#"  onfocus="this.blur();" onclick="ChangeBlock(' + msgblock[0] + ');return false;" onmousemove="movearea();" onmouseover="showMapInfo(' + msgblock[0] + ');" onmouseout="hidMapInfo(' + msgblock[0] + ');"  >';
                        ArBlockFile[msgblock[0]] = msgblock[1];
                    }
                }
                imagemap += '</map>';
                var maphtml = mapfiles + imagemap;
                $("#dMapInfo").html(maphtml);
            } else if (mapData != "") {

                var msgblocks = mapData.split(_lines);
                mapType = msgblocks[0];
                mapData = msgblocks[1].replace(/ alt=/gi, " info=");

                if ('https:' == document.location.protocol) {
                    mapData = mapData.replace('http://tkfile', 'https://stkfile')
                }

                if (mapType == "2") {
                    $("#dBigHtmlMap").html(mapData);
                    //20140403HTMLSEAT
                    //$("#dBigMapFocus").removeClass("mapFocus");
                    //$("#dMapFocus").addClass("bigmapFocus");
                    $("#dMapFocus").remove();
                    $("#dBigMapFocus").css("display", "");

                    $("#minimap, #minimapTitle, #dMapInfo").hide();
                    $(".minimap_m").prepend("<p class='btn_all'><a href='#'><img src='http://tkfile.yes24.com/images/ticket_new/btn_seat2_all.jpg' alt='공연장 전체보기' onclick='toggleBigHtmlMap(1);' /></a></p>");
                } else {
                    //20140403HTMLSEAT
                    $("#dMapFocus").css("display", "");
                    $("#dBigMapFocus").remove();
                    $("#dMapInfo").html(mapData);
                }

                if (navigator.userAgent.toLowerCase().indexOf('firefox') == -1) {
                    $("area").bind({
                        focus: function () {
                            $(this).blur();
                        }
                    });
                }
            }

            if (mapType != "2") {
                //20140403HTMLSEAT 순서변경
                $("#ulLegend").height(120);
                SetMapFocusPosition();
                GetSeatData(Block, 0);
            } else {
                $("#ulLegend").height(294);
                $("#liLegend").height(274);
                SetMapFocusPosition(); //20140320HTMLSEAT
                $("#progressbar").css("display", "none");
            }
        }
        //end 201402HTMLSEAT

        //백그라운드 이미지
        function CreateHallBgImg(bgImginfo) {
            var arbginfo = bgImginfo.split(_split);
            if (arbginfo.length > 1) {
                if (arbginfo[0] != "") {
                    $("#divContainer").css("background-image", "url('" + GetImgPath() + arbginfo[0] + "')");
                    $("#divContainer").css("background-repeat", "no-repeat");

                    if (arbginfo[1] != "" && arbginfo[2] != "") {
                        $("#divContainer").css("background-position", arbginfo[1] + "px " + arbginfo[2] + "px");
                    } else {
                        $("#divContainer").css("background-position", "0px 0px");
                    }
                } else {
                    $("#divContainer").css("background-image", "url('')");
                }
            } else {
                $("#divContainer").css("background-image", "url('')");
            }
        }

        //좌석등급별 가격보기
        function CreateLegend(args) {
            var disRemainSeat = 1; // 0 = show, 1 = hide
            disRemainSeat = $("#hiddenDisplayRemainSeat", parent.document).val();

            var resData = "";
            var legends = args.split(_lines);
            for (var i = 0; i < legends.length; i++) {
                var legend = legends[i].split(_split);
                if (legend.length > 1) {
                    var lblRemainSeat = "";
                    if (disRemainSeat == 0) {
                        lblRemainSeat = '<em>(' + legend[3] + '석)</em>';
                    }

                    if (mapType != 2) {
                        resData += '<div><p class="txt" ><img src="http://tkfile.yes24.com/images/ticket_new/ic_seat' + legend[0] + '.gif" alt="">' + legend[1] + ' ' + parent.fdc_fmtNumber(legend[2]) + '원' + lblRemainSeat + '</p></div>';
                    }
                    else {
                        resData += '<div style="cursor:pointer;"><p class="txt" name="btnGrade" id="grade_' + legend[1] + '"><img src="http://tkfile.yes24.com/images/ticket_new/ic_seat' + legend[0] + '.gif" alt="">' + legend[1] + ' ' + parent.fdc_fmtNumber(legend[2]) + '원' + lblRemainSeat + '</p></div>';
                    }
                }
            }
            $("#liLegend").html(resData);

            $('p[name="btnGrade"]').click(function () {

                toggleBigHtmlMap(1);
                var $obj = $(this);
                if ($obj.hasClass("ov")) {
                    $obj.removeClass("ov");
                    $obj.next().remove();
                }
                else {
                    var gradeList = $("#liLegend > div");
                    gradeList.children("p").removeClass("ov");
                    gradeList.children("ul").remove();

                    var resData = '<ul class="seat_layer" >';
                    for (var i = 0; i < ArSectionRemain.length; i++) {
                        var section = ArSectionRemain[i];
                        if (section.className == this.id.substr(6)) {
                            var lblRemainSeat = "";
                            if (disRemainSeat == 0) {
                                lblRemainSeat = '(' + section.seat + '석)';
                            }
                            resData += '<li style="cursor:pointer;" onclick="ChangeBlock(\'' + section.block + '\');">' + section.block + '구역' + lblRemainSeat + '</li>';
                        }
                    }
                    resData += "</ul>";
                    $obj.parent().append(resData);
                    $obj.addClass("ov");
                }
            });
        }

        function CreateSection(args) {
            var sections = args.split(_lines);
            var objectList = new Array();
            for (var i = 0; i < sections.length; i++) {
                var blkNo = sections[i].split(_split);
                if (blkNo.length > 1) {
                    var section = {};
                    section.className = blkNo[0];
                    section.block = blkNo[1];
                    section.seat = blkNo[2];
                    ArSectionRemain.push(section);
                }
            }
        }

        //블럭별 잔여석 정보 셋팅
        function CreateRemainArgs(blocktickets) {
            ArBlockRemain = new Array();
            var msgblocks = blocktickets.split(_lines);
            for (var i = 0; i < msgblocks.length; i++) {
                var blkNo = msgblocks[i].split(_split);
                if (blkNo.length > 1) {
                    ArBlockRemain[blkNo[0]] = blkNo[1];
                }
            }
        }

        //판매가능 좌석맵핑
        function TicketMapping(ticketData) {
            var tickets = ticketData.split(_lines);
            for (var i = 0; i < tickets.length; i++) {
                var ticket = tickets[i].split(_split);
                if (ticket.length > 3) {
                    var objtk = document.getElementById("t" + ticket[0]);
                    objtk.title = ticket[3];
                    objtk.className = "s" + ticket[1];

                    if (ticket[2] == "0") {
                        objtk.style.cursor = "hand";
                        objtk.onclick = ChoiceSeat;
                        $("#t" + ticket[0]).attr("grade", ticket[5]);
                    }
                }
            }
        }

        function showMapInfo(blk) {
            if (ArBlockRemain.length > 0) {

                document.getElementById("blkInfo").style.display = "";
                var mapobj = document.getElementById("area" + blk);

                var infoblk = "";
                if ($(mapobj).attr("info") != "undefined" && $(mapobj).attr("info") != null) {
                    infoblk = $(mapobj).attr("info");
                }
                var remainblk = "잔여석 0";
                if (isNaN(ArBlockRemain[blk]) == false) {
                    remainblk = "잔여석 " + ArBlockRemain[blk];
                }

                if (mapobj != null) {
                    if (infoblk != "") {
                        $("#blkInfo").html(infoblk + "<br />" + remainblk);
                    } else {
                        $("#blkInfo").html(remainblk);
                    }
                } else {
                    $("#blkInfo").html(remainblk);
                }
            }

            if (document.getElementById('mapOver') != null) {
                $("#mapOver").remove();
            }
            //201402HTMLSEAT
            if (Block != blk || mapType == "2") {
                MapFocusCreate(blk, 'mapOver', '#ff8500');
            }

            var now = new Date();
            var txtDate = now.getFullYear() + parent.jsf_def_PadLeft(now.getMonth() + 1, 2) + parent.jsf_def_PadLeft(now.getDate(), 2);

            //            if (IdTime == '600980') {
            //                if (parseInt(txtDate) < parseInt("20140926")) {                    
            //                    $("#blkInfo").hide();
            //                }
            //            }

            movearea()
        }

        function hidMapInfo(blk) {
            document.getElementById("blkInfo").style.display = "none";
        }

        function movearea(e) {
            var ypos = 0;
            var xpos = 0;
            var ewidth = document.getElementById("blkInfo").offsetWidth;
            if (ewidth == 0) {
                return;
            }

            try {
                xpos = window.event.clientX;
                ypos = window.event.clientY;
            } catch (e) {
                ypos = window.event.y;
                xpos = window.event.x;
            }

            $("#blkInfo").css({ top: ypos, left: xpos - (ewidth + 6) });
        }

        function closeseat() {
            try {
                parent.fdc_FlashSeatUnload();
            } catch (e) {
                document.domain = "yes24.com";
                parent.fdc_FlashSeatUnload();
            }
        }

        function ChoiceEndProcess(vselseat) {
            try {
                parent.fdc_FlashSeatChoiceEnd(vselseat);
            } catch (e) {
                document.domain = "yes24.com";
                parent.fdc_FlashSeatChoiceEnd(vselseat);
            }
        }

        function resetseat() {
            try {
                parent.fdc_FlashSeatLoad();
            } catch (e) {
                document.domain = "yes24.com";
                parent.fdc_FlashSeatLoad();
            }
        }

        function outMap() {
            if (document.getElementById('mapOver') != null) {
                $("#mapOver").remove();
            }
        }

        function MapFocusCreate(blk, objId, bcolor) {
            try {
                $(objId).remove(); //20140403HTMLSEAT
                var curshape = $("#area" + blk).attr("shape");
                var curcoords = $("#area" + blk).attr("coords");

                if (curshape.toLowerCase() == "rect") {
                    var arshape = $("#area" + blk).attr("coords").split(',');
                    var mapx1 = parseInt(arshape[0]);
                    var mapy1 = parseInt(arshape[1]);
                    var mapx2 = parseInt(arshape[2]) - mapx1;
                    var mapy2 = parseInt(arshape[3]) - mapy1;
                    var elPoint = document.createElementNS(svgns, 'rect');
                    elPoint.setAttribute('id', objId);
                    elPoint.setAttribute('fill', bcolor);
                    elPoint.setAttribute('x', mapx1);
                    elPoint.setAttribute('y', mapy1);
                    elPoint.setAttribute('width', mapx2);
                    elPoint.setAttribute('height', mapy2);
                    //20140403HTMLSEAT
                    if (mapType == "2") {
                        var objSvg = document.getElementById('svgmapbig');
                        objSvg.appendChild(elPoint);
                    } else {
                        var objSvg = document.getElementById('svgmap');
                        objSvg.appendChild(elPoint);
                    }
                } else {
                    var elPoint = document.createElementNS(svgns, 'polygon');
                    elPoint.setAttribute('id', objId);
                    elPoint.setAttribute('fill', bcolor);
                    elPoint.setAttribute('points', curcoords);
                    //20140403HTMLSEAT
                    if (mapType == "2") {
                        var objSvg = document.getElementById('svgmapbig');
                        objSvg.appendChild(elPoint);
                    } else {
                        var objSvg = document.getElementById('svgmap');
                        objSvg.appendChild(elPoint);
                    }
                }
            } catch (e) { }
        }

        //begin 201402HTMLSEAT
        function SetMapFocusPosition() {
            try {
                if (mapType == "2") {
                    var imgMapPos = $(".bigSeatMap > img[usemap*=#]").offset();
                    if (imgMapPos != null) {
                        var imgMapTypex = imgMapPos.left;
                        var imgMapTypey = imgMapPos.top;
                        //20140403HTMLSEAT
                        var mapwidth = $(".bigSeatMap > img[usemap*=#]").attr("width");
                        $("#dBigMapFocus").css({ top: imgMapTypey, left: imgMapTypex, width: mapwidth });
                        $("#svgmapbig").css({ width: mapwidth });
                    }
                } else {
                    var imgMapPos = $(".seatMap > img[usemap*=#]").offset();
                    if (imgMapPos != null) {
                        var imgMapTypex = imgMapPos.left;
                        var imgMapTypey = imgMapPos.top;
                        $("#dMapFocus").css({ top: imgMapTypey, left: imgMapTypex });
                    }
                }

            } catch (e) {
                alert(e);
            }
        }
        //end 201402HTMLSEAT

        if (navigator.userAgent.toLowerCase().indexOf('firefox') >= 0) {
            (function () {
                var events = ["mousedown", "mouseover", "mouseout", "mousemove", "mousedrag", "click", "dblclick"];
                for (var i = 0; i < events.length; i++) {
                    window.addEventListener(events[i], function (e) {
                        window.event = e;
                    }, true);
                }
            } ());
        };

        $(document).ready(function () {
            $(document).bind('contextmenu.perfsalehtmlseat', function (e) { return false; });



        });

        //20140403HTMLSEAT
        (function ($) {
            window.addEventListener('SVGLoad', function () {
                isLoadedSvg = true;
            }, false);
        })(jQuery);
    </script>
    

<!-- LOGGER SCRIPT FOR SETTING ENVIRONMENT V.27 :  / FILL THE VALUE TO SET. -->
<!-- COPYRIGHT (C) 2002-2004 BIZSPRING INC. LOGGER(TM) ALL RIGHTS RESERVED. -->

<!-- START OF ENVIRONMENT SCRIPT -->
<script type="text/javascript">
    /* FOR BIZ., COM. AND ENT. SERVICE. */
    _TRK_CP = "/공연/결제/좌석"; /* Contents Path */
    _TRK_PI = ""; /* Page Identity */
    _TRK_PN = ""; /* Product Name */
    _TRK_MF = ""; /* Manufacture Name */
    _TRK_OA = ""; /* Order Amount(s) with ';' Separated */
    _TRK_OP = ""; /* Order Product(s) with ';' Separated */
    _TRK_OE = ""; /* Order EA with ';' Separated */
    _TRK_CC = ""; /* Campaign Code */
    _TRK_RK = ""; /* Reserved Key */
    _TRK_SX = ""; /* Members Gender - M,F,U */
    _TRK_AG = ""; /* Member Age - A,B,C,D,E,F,G */
    _TRK_IK = ""; /* Inner Search Keyword */
</script>
<!-- END OF ENVIRONMENT SCRIPT -->




    
 
<!-- WEMS TRACKING SCRIPT CODE START -->
<!-- DO NOT MODIFY THIS SCRIPT CODE. -->
<!-- COPYRIGHT (C) 1999-2008 NETHRU INC. ALL RIGHTS RESERVED. -->


<script type="text/javascript" src="http://www.yes24.com/javascript/wlo.js"></script>


<script type="text/javascript">
//    (function () {
//        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'www.yes24.com/javascript/wlo.js';
//        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
//    })();

    _n_sid = "08070200045";
    _n_uid_cookie = "Mallinmall_CKMI";
    _n_info1_cookie = "PID";
    n_logging();
</script>

<!-- WEMS TRACKING SCRIPT CODE END -->


    </form>
    </body>
</html>

